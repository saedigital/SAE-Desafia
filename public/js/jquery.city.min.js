/**
 * @author Maicon Gon√ßalez
 * @email maicon@maiscontrole.net
 */
(function($){
	$.fn.seleccity = function(options,init,call){
		var defaults = {
          Select_Target: "#select_city",
		  Link_Json: "brasi.json",
		  data: "",
        };
        var settings = $.extend( {}, defaults, options );
		var callback = call;
		var initfunction = init;
		
        return this.each(function() {
			var Last_UF = "";
			var Elent = $(this);
			if (settings.data === ""){
				var datas = $.ajax({  
						type: "GET",
						dataType: "json",
						url: settings.Link_Json,
						data: {ajax: true},
						success : function(datas){
							for(var estado in datas){
								$('<option value="'+estado+'">'+estado+'</option>').appendTo(Elent);
								settings.data = datas;
							}
							if(typeof initfunction === 'function') {
								return initfunction();								
							}
						}
				});
			}
			Elent.change(function(e){
				setOption($(this).val(),$(this))
			});
			Elent.click(function(e){
				setOption($(this).val(),$(this))
			});
			function setOption(uf,obj){
				if ((Last_UF == "" || Last_UF != null) && Last_UF != uf){
					$(settings.Select_Target).html('<option value="select">Selecione sua Cidade</option>');
					for(var id in settings.data[uf]){
						$('<option value="'+settings.data[uf][id]+'">'+settings.data[uf][id]+'</option>').appendTo(settings.Select_Target);
					}
					Last_UF = uf;
				}
				if (obj.data('city') != undefined){
					$(settings.Select_Target).val(obj.data('city'));
				}
				if(typeof callback === 'function') {
					return callback();
				}
			};
        });
	}
})(jQuery);