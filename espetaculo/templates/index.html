{% extends 'base.html' %}

{% block content %}
<div id="page-wrapper">
         <div class="row">
             <div class="col-lg-12">
                 <h1 class="page-header">Espetáculos
                     <a class="btn btn-success add-espetaculo btn-circle"  data-toggle="tooltip" title="Adicionar espetáculo"><span class="glyphicon glyphicon-plus"></span></a>
                </h1>
            </div>
             <!-- /.col-lg-12 -->
             <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-default">
                         
                            <div id="content-table" class="panel-body">
                                <table width="100%" class="table table-striped table-bordered table-hover" >
                                    <thead>
                                        <tr>
                                            <th>Titulo</th>
                                            <th>Data</th>
                                            <th>Arrecadado</th>
                                            <th>Detalhes</th>
                                            <th>Excluir</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for espetaculo in espetaculos %}
                                        <tr class="odd gradeX">
                                            <td class="center">{{espetaculo}}</td>
                                            <td class="center">{{espetaculo.data|date:"d/m/Y"}}</td>
                                            <td class="center">R$ {{espetaculo.arrecadado}}</td>
                                            <td class="center"><a href="{% url 'detalhes' espetaculo.pk %}" class="btn btn-primary btn-circle"  data-toggle="tooltip" title="Detalhes espetáculo"><span class="glyphicon glyphicon-edit"></span></a></td>
                                            <td class="center"><a href="{% url 'deletar' espetaculo.pk %}" class="btn btn-danger btn-circle" data-toggle="tooltip" title="Excluir espetáculo"><span class="glyphicon glyphicon-remove"></span></a></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
         </div>
</div>
<div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="modal fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                 
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                    ×
                                </button>
                                <h4 class="modal-title" id="myModalLabel">
                                    Adicionar Espetáculo
                                </h4>
                            </div>
                            <div class="modal-body">
                                ...
                            </div>
                            
                        </div>
                        
                    </div>
                    
                </div>
                
            </div>
        </div>
    </div>

{% endblock content %}

{% block extrajs %}
<script>
    var csrftoken = $.cookie('csrftoken');
    $('.add-espetaculo').on('click', function(){
            action = "{% url 'add-espetaculo' %}";
            $.ajax({
                type: "GET",
                url: action,
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                },
                success: function (data) {
                     $('.modal-body').html(data);
                     $('form', '.modal-body').attr('action', action);
                     console.log($('form', '.modal-body'));
                }
            });
            $('.modal').modal('show');
    });
    $(document).on('submit', '#form-ajax',  function(e){
            e.preventDefault();
            action =   $('form', '.modal-body').attr('action');

            $.ajax({
                type: "POST",
                data: $('form', '.modal-body').serialize(),
                url: action, 
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    var load = '<div class="text-center"><i class="fa fa-refresh fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span></div>';
                    $('.modal-body').html(load);
                },
                success: function (data) {
                    $('#content-table').html('');
                    $('#content-table').html(data);
                    drawtable();
                    $('.modal').modal('hide');
                },
                error :function(data){
                    $('.modal-body').html(data.responseText);
                    $('form', '.modal-body').attr('action', action);
                }
            });
        })
function drawtable(){
    $('table').DataTable({
        "language": {
            "sEmptyTable": "Nenhum registro encontrado",
            "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
            "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
            "sInfoFiltered": "(Filtrados de _MAX_ registros)",
            "sInfoPostFix": "",
            "sInfoThousands": ".",
            "sLengthMenu": "_MENU_ resultados por página",
            "sLoadingRecords": "Carregando...",
            "sProcessing": "Processando...",
            "sZeroRecords": "Nenhum registro encontrado",
            "sSearch": "Pesquisar",
            "oPaginate": {
                "sNext": "Próximo",
                "sPrevious": "Anterior",
                "sFirst": "Primeiro",
                "sLast": "Último"
            },
            "oAria": {
                "sSortAscending": ": Ordenar colunas de forma ascendente",
                "sSortDescending": ": Ordenar colunas de forma descendente"
            }
        }
    });
}
drawtable();
</script>
{% endblock extrajs %}